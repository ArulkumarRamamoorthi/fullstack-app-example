pipeline {
    agent any

    environment {
        DOCKERHUB_CREDENTIALS = credentials('dockerhub-cred')
        DOCKERHUB_USER = 'arulkumar306'
        BACKEND_IMAGE = "arulkumar306/backend"
        FRONTEND_IMAGE = "arulkumar306/frontend"
        BACKEND_CONTAINER = "backend-container"
        FRONTEND_CONTAINER = "frontend-container"
    }

    tools {
        jdk 'jdk17'
        nodejs 'node25'
    }

    stages {
        stage('Checkout Code') {
            steps {
                git branch: 'main', url: 'https://github.com/your-repo-url.git'
            }
        }

        stage('Install Dependencies') {
            steps {
                dir('backend') {
                    sh 'npm ci'
                }
                dir('frontend') {
                    sh 'npm ci'
                }
            }
        }

        stage('Trivy File Scan') {
            steps {
                sh '''
                echo "üîç Scanning source files..."
                trivy fs --exit-code 0 --severity HIGH,CRITICAL .
                '''
            }
        }

        stage('Build Docker Images') {
            steps {
                sh '''
                echo "‚öôÔ∏è Building Docker images..."
                docker build -t ${BACKEND_IMAGE}:latest ./backend
                docker build -t ${FRONTEND_IMAGE}:latest ./frontend
                '''
            }
        }

        stage('Trivy Image Scan') {
            steps {
                sh '''
                echo "üîç Scanning backend image..."
                trivy image --exit-code 0 --severity HIGH,CRITICAL ${BACKEND_IMAGE}:latest || true
                echo "üîç Scanning frontend image..."
                trivy image --exit-code 0 --severity HIGH,CRITICAL ${FRONTEND_IMAGE}:latest || true
                '''
            }
        }

        stage('Push to Docker Hub') {
            steps {
                sh '''
                echo "üöÄ Pushing images to Doc
